# buou_grid
## 视频说明：[https://youtu.be/CKlJ4K1rUW0](https://www.youtube.com/watch?v=Jf03Cuq0aFc)


##### 配置说明：

###### COIN_NAME = "XRP"  # 交易币种

###### CONTRACT_TYPE = "USDT"  # 合约类型：USDT 或 USDC

###### GRID_SPACING = 0.004  # 上下挂单间距 (0.3%)

###### INITIAL_QUANTITY = 0.05  # 初始交易数量 (币的数量)

###### LEVERAGE = 50  # 杠杆倍数

###### WEBSOCKET_URL = "wss://ws.okx.com:8443/ws/v5/public"  # WebSocket URL

###### WEBSOCKET_PRIVATE_URL = "wss://ws.okx.com:8443/ws/v5/private"  # 私有频道URL

###### POSITION_THRESHOLD = 4  # 锁仓阈值，持仓币的数量达到此值不再开单

###### POSITION_LIMIT = 1  # 持仓数量阈值，持仓币的数量达到此值对向倍投

###### SYNC_TIME = 60  # 同步时间（秒）

###### ORDER_FIRST_TIME = 10  # 首单间隔时间



### 该网格在90%行情下表现较好，建议追求年化50%收益设计
### 苟富贵勿相忘，如果觉得思路不错，打赏地址trc20: TUunBuqQ1ZDYt9WrA3ZarndFPQgefXqZAM
###### 有带broker id

---

## 策略流程圖（文字版）
資料 → 指標 → 訊號 → 下單 → 風控 → 持倉更新

## 完整策略規格
> 以下規格以 `grid_BN_XRP.py` 的網格思想為基礎，便於擴充或移植到其他品種。

### 1) 資料輸入與時間維度
- **行情資料**：即時成交價/最新價（WebSocket 或 REST 拉取）。
- **品種/合約**：以 `COIN_NAME` + `CONTRACT_TYPE` 組合決定交易對。
- **同步頻率**：`SYNC_TIME` 進行狀態同步（含倉位、掛單、風控條件）。

### 2) 指標與網格參數
- **網格間距**：`GRID_SPACING`，固定百分比上下分布。
- **初始倉位**：`INITIAL_QUANTITY`，首單或補單的單筆數量。
- **槓桿**：`LEVERAGE`。
- **網格層級**：以上下掛單方式在價格周圍形成對稱網格。

### 3) 訊號邏輯
- **做多訊號**：價格下穿前一格位，觸發向下補單。
- **做空訊號**：價格上穿前一格位，觸發向上補單。
- **方向切換**：依據持倉量與對向倍投條件動態調整。

### 4) 下單流程
1. **初始化**：根據 `ORDER_FIRST_TIME` 在策略啟動後延遲首單。
2. **掛單**：在上下格位掛限價單（買/賣）。
3. **成交追蹤**：成交後以固定間距補掛下一格。

### 5) 風控規則
- **鎖倉閾值**：`POSITION_THRESHOLD`，持倉幣量達到此值則暫停新增同向倉位。
- **對向倍投**：`POSITION_LIMIT`，持倉幣量達到此值則啟動對向加碼對沖。
- **同步檢查**：`SYNC_TIME` 週期檢查倉位與掛單是否偏離策略規格。

### 6) 持倉更新
- 成交即更新持倉與平均成本。
- 達到鎖倉閾值後只允許平倉或對沖單。
- 當持倉回落到安全區間，恢復正常網格補單。

## 風控說明（補充）
| 風控項目 | 參數 | 觸發條件 | 動作 |
| --- | --- | --- | --- |
| 鎖倉控制 | POSITION_THRESHOLD | 持倉幣量 ≥ 閾值 | 暫停新增同向掛單 |
| 對向倍投 | POSITION_LIMIT | 持倉幣量 ≥ 閾值 | 啟動對向加碼對沖 |
| 同步校驗 | SYNC_TIME | 到達同步週期 | 校正掛單/倉位狀態 |

## 測試案例表
| 測試名稱 | 前置條件 | 操作 | 期望結果 |
| --- | --- | --- | --- |
| 首單延遲 | 參數已配置 | 啟動策略 | `ORDER_FIRST_TIME` 秒後才掛首單 |
| 網格補單 | 價格穿越格位 | 模擬價格上/下穿 | 觸發對應方向掛單 |
| 鎖倉保護 | 持倉幣量達閾值 | 模擬連續成交 | 暫停新增同向掛單 |
| 對向倍投 | 持倉幣量達閾值 | 模擬單邊行情 | 啟動對向掛單 |
| 同步校正 | 到達同步週期 | 模擬異常掛單 | 重新校正掛單與倉位 |

## 合成行情測試（Synthetic Market Test）
1. **準備資料**
   - 產生或匯入一段價格序列（如隨機漫步、鋸齒型、單邊趨勢）。
   - 格式：時間戳 + 價格。
2. **替換行情輸入**
   - 將行情輸入改為讀取本地資料（例如 CSV 或內存序列）。
   - 每次迭代輸入一筆價格更新，模擬即時行情。
3. **執行策略**
   - 依時間順序餵價，觀察掛單與持倉變化。
   - 記錄成交、倉位、資金曲線。
4. **驗證指標**
   - 網格是否按間距掛單。
   - 風控是否在觸發點生效。
   - 持倉是否更新正確。

## 回測步驟（若有）
> 若你已有歷史行情資料或回測框架，可依以下步驟進行。
1. **載入歷史資料**：K 線或逐筆成交。
2. **逐筆回放**：以時間序列驅動策略。
3. **記錄績效**：收益、最大回撤、成交頻率。
4. **分析結果**：檢查策略是否在不同波動區間維持穩定。
